<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Time Based OTP</title>
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
        <!-- Materialize CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">

        <!-- Material You Colors -->
        <style>
            :root {
                --primary-color: #bdb76b;
                --secondary-color: #f5f5dc;
                --error-color: #b00020;
            }

            body {
                font-family: 'Roboto', sans-serif;
                background-color: var(--secondary-color);
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                margin: 0;
            }

            .container {
                text-align: center;
                background-color: #fffaf0;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                width: 90%;
                max-width: 400px;
            }

            h1 {
                color: var(--primary-color);
                font-size: 24px;
                font-weight: bold;
            }

            #qr-code {
                margin-top: 20px;
                margin-bottom: 20px;
                max-width: 100%;
                border-radius: 8px;
            }

            input[type="text"] {
                font-size: 16px;
                padding: 10px;
                margin: 15px 0;
                border-radius: 8px;
                border: 1px solid #ccc;
                width: 100%;
                box-sizing: border-box;
                outline: none;
            }

            input[type="text"]:focus {
                border-color: var(--primary-color);
                box-shadow: 0 0 5px rgba(189, 183, 107, 0.5);
            }

            button {
                background-color: var(--primary-color);
                color: #ffffff;
                border: none;
                padding: 10px 15px;
                border-radius: 8px;
                width: 100%;
                transition: all 0.3s ease;
            }

            button:hover {
                background-color: #808000;
            }

            button:active {
                background-color: #6b8e23;
            }

            .snackbar {
                visibility: hidden;
                min-width: 250px;
                background-color: #323232;
                color: #fff;
                text-align: center;
                border-radius: 8px;
                padding: 10px;
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1;
                font-size: 14px;
            }

            .snackbar.show {
                visibility: visible;
                animation: fadeInOut 3s ease-in-out;
            }

            .btn {
                padding: 0.5rem;
                height: auto;
                border-radius: 100px;
                font-weight: bold;
            }

            @keyframes fadeInOut {
                0% {
                    opacity: 0;
                    bottom: 0;
                }

                10%,
                90% {
                    opacity: 1;
                    bottom: 20px;
                }

                100% {
                    opacity: 0;
                    bottom: 0;
                }
            }

        </style>
    </head>

    <body>
        <div class="container">
            <h1>Time-based OTP</h1>
            <p>Scan the QR code with your 2FA application<br />(e.g., Microsoft Authenticator).</p>
            <img id="qr-code" src="" alt="QR Code" />
            <div>
                <input type="text" id="totp-input" placeholder="Enter OTP" />
                <button id="verify-button" class="waves-effect waves-light btn">Verify</button>
            </div>
        </div>

        <div id="snackbar" class="snackbar"></div>

        <script>
            // Fetch the QR code from the backend
            fetch('/generate-qr')
                .then(response => response.json())
                .then(data => {
                    const qrCodeUrl = data.qrCodeUrl;
                    document.getElementById('qr-code').src = qrCodeUrl;
                });

            // Display snackbar messages
            function showSnackbar (message, isSuccess = true) {
                const snackbar = document.getElementById('snackbar');
                snackbar.textContent = message;
                snackbar.style.backgroundColor = isSuccess ? "var(--primary-color)" : "var(--error-color)";
                snackbar.className = "snackbar show";

                // Hide snackbar after 3 seconds
                setTimeout(() => {
                    snackbar.className = snackbar.className.replace("show", "");
                }, 3000);
            }

            // Verify the entered TOTP
            document.getElementById('verify-button').addEventListener('click', () => {
                const token = document.getElementById('totp-input').value;

                fetch('/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message === 'Valid TOTP') {
                            showSnackbar('OTP Verified Successfully!', true);
                        } else {
                            showSnackbar('Invalid OTP', false);
                        }
                    })
                    .catch(error => {
                        showSnackbar('Error occurred while verifying OTP', false);
                    });
            });
        </script>
    </body>

</html>
